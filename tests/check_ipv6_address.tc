#include "Arduino.h"

#include "MACAddress.h"
#include "IPv6Address.h"
#suite IPv6Address

const uint8_t zero[16] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
};


#test new_IPv6Address
IPv6Address addr;
ck_assert(memcmp(zero, addr, 16) == 0);


#test setZero
uint8_t expect[16] = {
  0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
  0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F
};
IPv6Address *addr = (IPv6Address *)expect;
addr->setZero();
ck_assert(memcmp(zero, addr, 16) == 0);


#test isZero_true
const IPv6Address *addr = (const IPv6Address *)zero;
ck_assert(addr->isZero() == true);


#test isZero_false
uint8_t expect[16] = {
  0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07,
  0x08, 0x09, 0x0A, 0x0B, 0x0C, 0x0D, 0x0E, 0x0F
};
IPv6Address *addr = (IPv6Address *)expect;
ck_assert(addr->isZero() == false);


#test fromString_home
uint8_t expect[16] = {
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
  0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01
};
IPv6Address addr;
boolean result = addr.fromString("::1");
ck_assert(result == true);
ck_assert(memcmp(expect, addr, 16) == 0);


#test fromString_zero
IPv6Address addr;
boolean result = addr.fromString("::");
ck_assert(result == true);
ck_assert(addr.isZero() == true);


#test fromString_googlePublicDNS
uint8_t expect[16] = {
    0x20, 0x01, 0x48, 0x60, 0x48, 0x60, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x88, 0x88
};
IPv6Address addr;
boolean result = addr.fromString("2001:4860:4860::8888");
ck_assert(result == true);
ck_assert(memcmp(expect, addr, 16) == 0);


#test fromString_googlePublicDNS_expanded
uint8_t expect[16] = {
    0x20, 0x01, 0x48, 0x60, 0x48, 0x60, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x88, 0x88
};
IPv6Address addr;
boolean result = addr.fromString("2001:4860:4860:0000:0000:0000:0000:8888");
ck_assert(result == true);
ck_assert(memcmp(expect, addr, 16) == 0);


#test fromString_invalid
IPv6Address addr;
boolean result = addr.fromString("2001*4860*4860*0000*0000*0000*0000*8888");
ck_assert(result == false);


#test new_string_googlePublicDNS
uint8_t expect[16] = {
    0x20, 0x01, 0x48, 0x60, 0x48, 0x60, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x88, 0x88
};
IPv6Address addr("2001:4860:4860:0000:0000:0000:0000:8888");
ck_assert(memcmp(expect, addr, 16) == 0);


#test setLinkLocal
uint8_t expect[16] = {
    0xfe, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x03, 0x23, 0x45, 0xff, 0xfe, 0x67, 0x89, 0x10
};
MACAddress macAddress("01:23:45:67:89:10");
IPv6Address addr;
addr.setLinkLocalPrefix();
addr.setEui64(&macAddress);
ck_assert(memcmp(expect, addr, 16) == 0);


#test isLinkLocal
IPv6Address addr("fe80::0323:45ff:fe67:8910");
ck_assert(addr.isLinkLocal() == true);


#test isLinkLocal_global
IPv6Address addr("2001:4860:4860::8888");
ck_assert(addr.isLinkLocal() == false);


#test setLinkLocalAllNodes
uint8_t expect[16] = {
    0xff, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01
};
IPv6Address addr;
addr.setLinkLocalAllNodes();
ck_assert(memcmp(expect, addr, 16) == 0);


#test isLinkLocalAllNodes_true
IPv6Address addr;
addr.setLinkLocalAllNodes();
ck_assert(addr.isLinkLocalAllNodes() == true);


#test isLinkLocalAllNodes_false
IPv6Address addr;
ck_assert(addr.isLinkLocalAllNodes() == false);


#test setLinkLocalAllRouters
uint8_t expect[16] = {
    0xff, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02
};
IPv6Address addr;
addr.setLinkLocalAllRouters();
ck_assert(memcmp(expect, addr, 16) == 0);


#test isLinkLocalAllRouters_true
IPv6Address addr;
addr.setLinkLocalAllRouters();
ck_assert(addr.isLinkLocalAllRouters() == true);


#test isLinkLocalAllRouters_false
IPv6Address addr;
ck_assert(addr.isLinkLocalAllRouters() == false);


#test isMulticast
IPv6Address addr("ff02::1");
ck_assert(addr.isMulticast() == true);


#test isMulticast_global
IPv6Address addr("2001:4860:4860::8888");
ck_assert(addr.isMulticast() == false);


#test setSolicitedNodeMulticastAddress
uint8_t expect[16] = {
    0xff, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x01, 0xff, 0x00, 0x88, 0x88
};
IPv6Address globalAddr("2001:4860:4860::8888");
IPv6Address addr;
addr.setSolicitedNodeMulticastAddress(&globalAddr);
ck_assert(memcmp(expect, addr, 16) == 0);


#test isSolicitedNodeMulticastAddress_true
IPv6Address globalAddr("2001:4860:4860::8888");
IPv6Address addr;
addr.setSolicitedNodeMulticastAddress(&globalAddr);
ck_assert(addr.isSolicitedNodeMulticastAddress(&globalAddr) == true);


#test isSolicitedNodeMulticastAddress_false
IPv6Address globalAddr("2001:4860:4860::8888");
IPv6Address addr;
ck_assert(addr.isSolicitedNodeMulticastAddress(&globalAddr) == false);


#test equal
uint8_t addrBuf[16] = {
    0x20, 0x01, 0x48, 0x60, 0x48, 0x60, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x88, 0x88
};
IPv6Address addr("2001:4860:4860::8888");
IPv6Address *addr2 = (IPv6Address*)addrBuf;
ck_assert(addr == *addr2);

#test getType_global
IPv6Address addr("2001:4860:4860::8888");
ck_assert_int_eq(addr.getType(), ADDRESS_TYPE_GLOBAL);

#test getType_linkLocal
IPv6Address addr("fe80::0323:45ff:fe67:8910");
ck_assert_int_eq(addr.getType(), ADDRESS_TYPE_LINK_LOCAL);

#test getType_multicast
IPv6Address addr("ff02::2");
ck_assert_int_eq(addr.getType(), ADDRESS_TYPE_MULTICAST);

